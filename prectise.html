<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sprite Sheet Playback & Scrubbing</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      overflow: hidden;
      height: 100%;
    }
    /* The canvas fills the viewport */
    #displayCanvas {
      display: block;
      width: 100vw;
      height: 100vh;
      background: #000;
    }
  </style>
</head>
<body>
  <!-- Canvas for playback and scrubbing -->
  <canvas id="displayCanvas"></canvas>
  <script>
    (function() {
      const canvas = document.getElementById('displayCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      // Sprite sheet configuration (original resolution sprite sheet)
      const totalFrames = 256;  // 256 frames (16x16 grid)
      const columns = 16;
      const originalFrameWidth = 600;   // Original width per frame
      const originalFrameHeight = 600;  // Original height per frame
      
      // Playback configuration
      const frameRate = 20; // Playback frame rate (20 fps)
      const frameDuration = 1000 / frameRate;
      
      let currentFrameIndex = 0;
      let lastUpdateTime = performance.now();
      let playing = true;
      
      // Scrubbing state
      let scrubbing = false;
      let startX = 0;
      let startFrameIndex = 0;
      const sensitivity = 1; // 1 pixel movement = 1 frame
      
      // Load the sprite sheet (using WebP for smaller file size)
      const spriteSheet = new Image();
      spriteSheet.src = "assets/spritesheet.webp"; // Updated path
      
      // Pointer events for scrubbing
      canvas.addEventListener('pointerdown', (e) => {
        scrubbing = true;
        playing = false;
        startX = e.clientX;
        startFrameIndex = currentFrameIndex;
      });
      
      canvas.addEventListener('pointermove', (e) => {
        if (!scrubbing) return;
        const diffX = e.clientX - startX;
        let newIndex = startFrameIndex + diffX * sensitivity;
        newIndex = ((newIndex % totalFrames) + totalFrames) % totalFrames;
        currentFrameIndex = Math.floor(newIndex);
      });
      
      canvas.addEventListener('pointerup', () => {
        if (!scrubbing) return;
        scrubbing = false;
        playing = true;
        lastUpdateTime = performance.now();
      });
      
      canvas.addEventListener('pointercancel', () => {
        scrubbing = false;
        playing = true;
        lastUpdateTime = performance.now();
      });
      
      canvas.addEventListener('contextmenu', (e) => e.preventDefault());
      
      // Main draw loop
      function draw() {
        const now = performance.now();
        if (playing && !scrubbing) {
          const delta = now - lastUpdateTime;
          if (delta >= frameDuration) {
            const framesToAdvance = Math.floor(delta / frameDuration);
            currentFrameIndex = (currentFrameIndex + framesToAdvance) % totalFrames;
            lastUpdateTime = now;
          }
        }
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Scale to fit the frame into the canvas while preserving aspect ratio.
        const scale = Math.min(canvas.width / originalFrameWidth, canvas.height / originalFrameHeight);
        const drawWidth = originalFrameWidth * scale;
        const drawHeight = originalFrameHeight * scale;
        const dx = (canvas.width - drawWidth) / 2;
        const dy = (canvas.height - drawHeight) / 2;
        
        const col = currentFrameIndex % columns;
        const row = Math.floor(currentFrameIndex / columns);
        const sx = col * originalFrameWidth;
        const sy = row * originalFrameHeight;
        
        ctx.drawImage(spriteSheet, sx, sy, originalFrameWidth, originalFrameHeight, dx, dy, drawWidth, drawHeight);
        
        requestAnimationFrame(draw);
      }
      
      spriteSheet.onload = function() {
        requestAnimationFrame(draw);
      };
      
      window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      });
      
    })();
  </script>
</body>
</html>
